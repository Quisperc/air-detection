# 空气检测系统

基于 STM32F103ZCT6 的多传感器空气质量监测系统，可检测温湿度、甲烷浓度、CO2、TVOC 和 PM2.5 微粒等多项空气质量指标。

## 系统概述

本系统使用多种传感器实时监测空气质量参数，包括：

- 温湿度（DHT11 传感器）
- 甲烷浓度（MQ4 传感器）
- CO2 和 TVOC 浓度（SGP30 传感器）
- PM2.5 粉尘浓度（GP2Y1014AU 传感器）

系统通过串口将各项数据实时上报，可用于室内空气质量监测、工业环境监测等场景。

## 硬件资源

### 主控芯片

- MCU：STM32F103ZCT6（ARM Cortex-M3 内核，72MHz 主频）
- 封装：LQFP144
- 工作电压：3.3V

### 传感器模块

#### 1. DHT11 温湿度传感器

- 功能：测量环境温度和湿度
- 测量范围：温度 0-50℃，湿度 20-90%RH
- 引脚连接：
  - 数据引脚：PC1（DHT11_DATA）和 PE3（DHT11_DATA2）
  - 工作电压：3.3V-5.5V

#### 2. MQ4 甲烷气体传感器

- 功能：检测甲烷气体浓度
- 测量方式：通过 ADC1 通道 10（PC0）
- 特点：需要预热和校准，校准时间约 5 分钟

#### 3. SGP30 气体传感器

- 功能：检测 CO2 当量浓度和 TVOC 浓度
- 测量范围：CO2（400-60000ppm），TVOC（0-60000ppb）
- 通信方式：I2C 接口
- 引脚连接：
  - SCL：PB10（I2C2_SCL）
  - SDA：PB11（I2C2_SDA）
  - 地址：0x58

#### 4. GP2Y1014AU 粉尘传感器

- 功能：检测 PM2.5 粉尘浓度
- 测量方式：通过 ADC2 通道 12（PC2）
- 控制引脚：PC3（用于 LED 控制）
- 采样周期：10ms

### 外设资源

#### ADC 转换器

- ADC1：用于 MQ4 传感器信号采集（通道 10）
- ADC2：用于 GP2Y1014AU 粉尘传感器信号采集（通道 12）

#### 通信接口

- USART1：串口通信，用于数据上报
  - TX：PA9
  - RX：PA10
  - 波特率：默认 115200bps

#### 定时器

- TIM3：用于 GP2Y1014AU 粉尘传感器的 LED 控制
  - 通道 4：PB1

#### I2C 接口

- I2C2：用于 SGP30 传感器通信
  - SCL：PB10
  - SDA：PB11

## 软件架构

### 代码结构

- `Core/Src/main.c`：主程序入口
- `Core/Src/dht11/`：DHT11 温湿度传感器驱动
- `Core/Src/mq4/`：MQ4 甲烷传感器驱动
- `Core/Src/sgp30/`：SGP30 气体传感器驱动
- `Core/Src/gp2y1014au/`：GP2Y1014AU 粉尘传感器驱动

### 功能实现

1. 系统初始化：配置时钟、初始化外设和传感器
2. 传感器数据采集：定期读取各传感器数据
3. 数据处理与上报：通过串口发送检测数据

## 使用指南

### 开发环境

- 推荐开发环境：STM32CubeIDE 或 MDK-ARM (Keil)
- 固件库：STM32Cube FW_F1 V1.8.4

### 编译与烧录

1. 使用 MDK-ARM (Keil)打开`MDK-ARM/air-detection.uvprojx`工程文件
2. 编译工程
3. 通过 ST-Link 或其他下载器将程序烧录到 STM32F103ZCT6 芯片

### 传感器校准

- MQ4 传感器需要预热和校准（约 5 分钟），上电后会自动进行校准
- SGP30 传感器需要预热，通常在 15 分钟后读数趋于稳定

### 数据接收

1. 连接 USART1（PA9/PA10）到 USB 转 TTL 模块
2. 使用串口调试工具（如串口助手）连接相应 COM 口
3. 波特率设置为 115200bps，数据位 8，停止位 1，无校验
4. 可接收到按以下格式输出的传感器数据：
   ```
   温度: 25.0°C, 湿度: 60.0%
   甲烷: 800.0 ppm
   CO2: 450 ppm, TVOC: 125 ppb
   PM2.5: 35.0 ug/m³
   ```

## 注意事项

1. 首次使用时需等待 MQ4 和 SGP30 传感器预热完成（约 5-15 分钟）才能获得准确读数
2. DHT11 传感器不适合高精度场景，温湿度精度为 ±1℃/±1%RH
3. 系统工作电压为 3.3V，连接外部设备时注意电平匹配
4. 粉尘传感器需定期清洁，以保证测量精度

## 扩展功能

1. 可通过修改代码添加报警阈值，当检测数值超过安全范围时触发报警
2. 可扩展 WIFI/蓝牙模块实现远程数据监控
3. 可添加显示屏实现数据可视化
